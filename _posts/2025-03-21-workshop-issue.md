---
title: "쿼리스트링 filter 및 주문 결제 로직 등"
date: 2025-03-19
description: "API 정의서 및 ERD 궁금한거 정리"
categories:
  - Workshop
  - 1차 Project
tags: 
  - issue
  - API
  - filter
  - Specification
---

# 💁오늘의 안건

## 📌카테고리 명 가져오는 방법

<aside id="notion_callout">
🙋‍♀️

카테고리가 대분류/중분류 , 상품-카테고리 미들테이블로 구성되어있는데 카테고리명을 어떻게 가져올까?

</aside>

![image.png](/assets/post_img/250321/image2.png){: width="50%" .center}

![image.png](/assets/post_img/250321/image.png)

1. **front 에서 하드코딩한다.**
    - 쓰이는 방법이긴 한데 단점이 많음
        - 유지보수 및 데이터 일관성
        - 수정 후 빌드와 배포가 이루어져야함!!!(중요)
2. **DB에서 가져온다. → 어떻게?**
    - PRODUCT_AND_CATEGORY테이블에서 카테고리 명 가져오기
        
        ⇒ 카테고리는 존재하지만 해당 카테고리에 속하는 상품이 없는 경우가 있을 수 있음
        
        ⇒ PRODUCT_AND_CATEGORY는 상품과 카테고리의 관계 테이블임. 카테고리 분류에는 관계없음
        
    - 카테고리 명만 존재하는 테이블을 따로 만든다.
        
        ⇒ 테이블이 중복됨
        
    - 중분류 테이블에 해당하는 대분류 PK칼럼을 둬서 카테고리테이블만 조회한다.
        - ⇒ GOOD!!

---

## 📌상품 조회

<aside  class="notion_callout">
🙋‍♀️

상품조회 API설계할 때 쿼리스트링을 어떻게 줄까?

GET/ /product? …

</aside>

1. **key-value형식을 쓰자**
    
    ⇒  **간단하고 직관적**이며 **동적 필터링**을 쉽게 처리할 수 있는 방법임. 그러나 **보안 문제**, **URL 길이 제한**, **복잡한 조건 처리의 어려움**과 같은 단점도 있기 때문에, **사용할 경우 적절한 검증**과 **보안 조치**를 반드시 해야 함!
    
    - **간단한 필터링**에는 매우 유용하지만, **복잡한 필터링**이나 **민감한 데이터 처리**에는 적합X
2.  **filter를 쓰자** 
    
3. **한 키값에 여러 값이 들어가는 경우**

    ⇒ 콤마( , )로 구분해서 넣어주기


---

## 📌주문-결제

<aside  class="notion_callout">
🙋‍♀️

사용자 ) 장바구니 담기 → 구매하기 → 결제하기 할 때 실제 데이터 처리는 어떤 순서로 진행이 되는거지?

</aside>

- **순서**
    
    장바구니 담기(cart 테이블 저장) 
    
    → 결제하기 (PG) 
    
    → 결제 성공 (pay 테이블 저장) 
    
    → 주문완료 (order 테이블 저장)
    
- **예외 처리 및 고려 사항**
    - **결제 실패**: 결제 실패 시 사용자가 결제 정보를 다시 입력하도록 유도하고, 실패 사유를 상세히 전달
    - **트랜잭션 관리**: 결제와 주문 처리가 동시에 이루어지므로, **트랜잭션 관리**가 중요! 결제 테이블에 기록되고 주문 테이블에 기록되는 과정에서 **부분 실패**가 발생하지 않도록 해야 함. 예를 들어, 결제는 성공했지만 주문 저장이 실패한 경우, 결제 취소가 필요할 수 있음.
    - **중복 결제 방지**: 결제 시 여러 번 결제 요청이 들어오지 않도록 해야 하며, 이를 방지하기 위한 **락**(lock) 처리나 **결제 상태 체크**가 필요.
